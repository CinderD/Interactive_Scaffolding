# 项目运行指南

## 快速开始

### 步骤 1: 安装 Python 依赖

```bash
pip install -r requirements.txt
```

如果使用 Python 3，可能需要使用：
```bash
pip3 install -r requirements.txt
```

### 步骤 2: 配置 Azure 认证和 API 设置

#### 2.1 配置 API 端点信息

创建 `.env` 文件（参考 `.env.example`）：

```bash
cp .env.example .env
```

编辑 `.env` 文件，填入你的 Azure OpenAI 配置：

```bash
AZURE_OPENAI_ENDPOINT=https://your-endpoint.openai.azure.com/
AZURE_OPENAI_DEPLOYMENT=your-deployment-name
AZURE_OPENAI_API_VERSION=2024-10-21
```

#### 2.2 选择认证方式

**方式 A: Azure CLI（推荐用于开发）**

```bash
# 安装 Azure CLI（如果还没有）
# macOS: brew install azure-cli
# 或访问: https://docs.microsoft.com/cli/azure/install-azure-cli

# 登录 Azure
az login

# 验证登录
az account show
```

**方式 B: 使用 API Key（备选方案）**

在 `.env` 文件中添加：
```bash
AZURE_OPENAI_API_KEY=your-api-key-here
```

### 步骤 3: 启动 API 服务器

在项目目录下运行：

```bash
python api_server.py
```

或者使用启动脚本：

```bash
./start_api.sh
```

服务器默认会在 `http://localhost:5000` 启动。

**验证服务器运行：**
- 打开浏览器访问 `http://localhost:5000/health`
- 应该看到 `{"status": "ok"}`

### 步骤 4: 打开前端页面

1. 保持 API 服务器运行
2. 在浏览器中打开 `index.html` 文件
   - 可以直接双击文件
   - 或者使用本地服务器（推荐）：
     ```bash
     # Python 3
     python -m http.server 8000
     
     # 然后访问 http://localhost:8000/index.html
     ```

    - 或者使用项目自带脚本（推荐）：
       ```bash
       ./start_frontend.sh
       # 然后访问 http://localhost:8000/index.html
       ```

## 使用说明

1. **预设问题**：点击下方的预设问题按钮，系统会调用 LLM 生成回答
2. **自由提问**：在输入框中输入任何关于证明的问题
3. **交互模式**：
   - **Interactive 模式**：点击被模糊的内容来揭示答案
   - **Non-Interactive 模式**：所有内容直接显示
4. **Responsibility Slider**：调整学习责任级别（低=高支持，高=低支持）

## 故障排除

### 问题 1: "API Connection Error"

**原因**：API 服务器未运行或无法连接

**解决**：
- 确认 `api_server.py` 正在运行
- 检查终端是否有错误信息
- 确认 `index.html` 中的 `API_BASE_URL` 是否正确（默认是 `http://localhost:5000`）

### 问题 2: 认证错误

**错误信息**：`Error initializing Azure client`

**解决**：
- 确认已运行 `az login` 或设置了 `AZURE_OPENAI_API_KEY`
- 检查 Azure 账户是否有访问 OpenAI 资源的权限

### 问题 3: CORS 错误

**错误信息**：浏览器控制台显示 CORS 相关错误

**解决**：
- 确认 `flask-cors` 已安装：`pip install flask-cors`
- 如果使用文件协议打开 HTML，建议使用本地服务器（`python -m http.server`）

### 问题 4: 端口被占用

**错误信息**：`Address already in use`

**解决**：
- 修改 `api_server.py` 中的端口号
- 或使用环境变量：`PORT=5001 python api_server.py`
- 同时更新 `index.html` 中的 `API_BASE_URL`

## 项目结构

```
interactive_scaffolding/
├── index.html              # 主前端页面
├── api_server.py          # Flask API 服务器
├── requirements.txt       # Python 依赖
├── start_api.sh          # 启动脚本
├── README_API.md          # API 文档
└── fancy_version/         # 增强版前端（可选）
```

## 开发模式

如果需要修改代码后自动重载：

```bash
# 安装开发依赖
pip install flask[async]

# 使用 Flask 开发模式（自动重载）
export FLASK_ENV=development
python api_server.py
```

## 下一步

- 查看 `README_API.md` 了解 API 详细说明
- 查看 `index.html` 了解前端实现
- 根据需要调整 `api_server.py` 中的 prompt 和配置

